name: PR checks

on:
  push:
    branches:
      - feat/snapshot-testing
#  pull_request:
#    branches:
#      - feat/snapshot-testing

jobs:
  test:
    name: Test against snapshots

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: jwalton/gh-find-current-pr@v1
      id: findPr
      with:
        # Can be "open", "closed", or "all".  Defaults to "open".
        state: open
        # This will echo "Your PR is 7", or be skipped if there is no current PR.
    - run: echo "Your PR is ${PR}"
      if: success() && steps.findPr.outputs.number
      env:
        PR: ${{ steps.findPr.outputs.pr }}
    - run: echo $PR && echo " " && echo $GITHUB_RUN_ID
#      run: echo $GITHUB_RUN_ID <- WORKZ
#    - name: Set up Java 11
#      uses: actions/setup-java@v1
#      with:
#        java-version: '11'
#    - name: Gradle - Clean and verify snapshots with Paparazzi
#      id: testStep
#      run: ./gradlew clean snapshot-test:verifyPaparazziDebug
#    - name: Upload snapshot failure deltas
#      if: failure()
#      uses: actions/upload-artifact@v2
#      with:
#        name: snapshot-failure-deltas
#        path: snapshot-test/out/failures/delta-*.png
#    - name: Comment
#      uses: marocchino/sticky-pull-request-comment@v2
#      with:
#        message: |
#          ${{ env.GITHUB_RUN_ID }} $(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }')
#    - name: Comment (Success)
#      uses: actions/github-script@0.3.0
#      if: success()
#      with:
#        github-token: ${{ secrets.GITHUB_TOKEN }}
#        script: |
#          const { issue: { number: issue_number }, repo: { owner, repo }  } = context;
#          console.log(context);
#          const runUrl = 'https://github.com/' + owner + '/' + repo + '/actions/runs/' + `${{ env.GITHUB_RUN_ID }}`;
#          github.issues.createComment({ issue_number, owner, repo, body: 'All good with PR! :tada: ([Run]('+ runUrl +'))' });
#    - name: Comment (Failure)
#      uses: actions/github-script@0.3.0
#      if: failure()
#      with:
#        github-token: ${{ secrets.GITHUB_TOKEN }}
#        script: |
#          const { issue: { number: issue_number }, repo: { owner, repo }  } = context;
#          const runUrl = 'https://github.com/' + owner + '/' + repo + '/actions/runs/' + `${{ env.GITHUB_RUN_ID }}`;
#          github.issues.createComment({ issue_number, owner, repo, body: 'Problem with [run]('+ runUrl +')... :sob: \n\nMost likely the snapshots are not matching so a check at the artifacts section of the run is recommended.' });
